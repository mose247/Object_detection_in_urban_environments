# Object detection in urban environments

## Table of Contents
1. [Project Description](https://github.com/mose247/Object_detection_in_urban_environments/blob/main/README.md#project-description)
2. [Install & Run](https://github.com/mose247/Object_detection_in_urban_environments/blob/main/README.md#install--run)
3. [Methodology](https://github.com/mose247/Object_detection_in_urban_environments/blob/main/README.md#methodology)
4. [Future Work & Imporvements](https://github.com/mose247/Object_detection_in_urban_environments/blob/main/README.md#future-work--improvements)
## Project Description
In this project, pre-trained models from the [TensorFlow object detection API](https://tensorflow-object-detection-api-tutorial.readthedocs.io/en/latest/index.html) are fine-tuned in order to detect and classify cars, pedestrians and cyclists on the [Waymo Open Dataset](https://waymo.com/open/). In particular, experiments were conducted on **SSD MobileNet V2 FPNLite 640x640** and **SSD ResNet50 V1 FPN 640x640**, but you can find other models [here](https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf2_detection_zoo.md). 

The project leverages the following Amazon Web Services (AWS):
- [AWS Sagemaker](https://aws.amazon.com/sagemaker/) for training and deploying machine learning models;
- [AWS ECR](https://aws.amazon.com/ecr/?nc2=h_ql_prod_ct_ec2reg) for storing a docker container with all the dependencies required by the TF Object Detection API;
- [AWS S3](https://aws.amazon.com/s3/?nc2=h_ql_prod_st_s3) for storing tensorboard logs and accessing the dataset;
  
The dataset has already been exported using the [TFRecords format](https://tensorflow-object-detection-api-tutorial.readthedocs.io/en/latest/training.html#create-tensorflow-records) and stored in the public AWS S3 bucket `s3://cd2688-object-detection-tf2`. The images are saved with 640x640 resolution.

## Install & Run
To setup the project create a new SageMaker notebook instance and clone in it the Udacity's Object Detection in an Urban Environment [repository](https://github.com/udacity/cd2688-object-detection-in-urban-environment-project). Then, create a new S3 bucket for storing your personal tensorboard logs. 

> Note: while creating the notebook, make sure to attach the `AmazonS3FullAccess` and `AmazonEC2ContainerRegistryFullAccess` policies to its IAM Role in order to give your Sagemaker notebook instance access to S3 and ECR services.

Subsequently, add the files in the present repo to the cloned one by copying `my_train_models.ipynb` into the `1_model_training` directory and `my_deploy_models.ipynb` into the `2_model_inference` directory. This step ensure that you will have the relevant notebooks in their appropriate locations. 

Next, it is necessary to set up the configuration files to support the model training. To do this, add the provided config files to the `1_model_training/source_dir` directory. These configuration files play a crucial role in guiding the training process, so it's essential to have them in the right place.

Finally, to run the project and visualize the results:
1. run `my_train_models.ipynb` and follow the instructions in the notebook;
2. run `my_deploy_models.ipynb` and follow the instructions in the notebook;

## Methodology
![Loss_total_loss (1)](https://github.com/mose247/Object_detection_in_urban_environments/assets/91455159/6d3c1159-7de2-4b67-9aa0-8690d7e7f3e9)<svg viewBox="0 0 330 200" xmlns="http://www.w3.org/2000/svg"><g><g><g><g><g><line x1="50" y1="177" x2="45" y2="177" style="visibility: inherit;" fill="rgb(0, 0, 0)" stroke="rgb(204, 204, 204)" stroke-width="1px"></line><line x1="50" y1="157.33333333333337" x2="45" y2="157.33333333333337" style="visibility: inherit;" fill="rgb(0, 0, 0)" stroke="rgb(204, 204, 204)" stroke-width="1px"></line><line x1="50" y1="137.66666666666666" x2="45" y2="137.66666666666666" style="visibility: inherit;" fill="rgb(0, 0, 0)" stroke="rgb(204, 204, 204)" stroke-width="1px"></line><line x1="50" y1="118.00000000000003" x2="45" y2="118.00000000000003" style="visibility: inherit;" fill="rgb(0, 0, 0)" stroke="rgb(204, 204, 204)" stroke-width="1px"></line><line x1="50" y1="98.33333333333334" x2="45" y2="98.33333333333334" style="visibility: inherit;" fill="rgb(0, 0, 0)" stroke="rgb(204, 204, 204)" stroke-width="1px"></line><line x1="50" y1="78.66666666666666" x2="45" y2="78.66666666666666" style="visibility: inherit;" fill="rgb(0, 0, 0)" stroke="rgb(204, 204, 204)" stroke-width="1px"></line><line x1="50" y1="59.00000000000001" x2="45" y2="59.00000000000001" style="visibility: inherit;" fill="rgb(0, 0, 0)" stroke="rgb(204, 204, 204)" stroke-width="1px"></line><line x1="50" y1="39.33333333333333" x2="45" y2="39.33333333333333" style="visibility: inherit;" fill="rgb(0, 0, 0)" stroke="rgb(204, 204, 204)" stroke-width="1px"></line><line x1="50" y1="19.666666666666696" x2="45" y2="19.666666666666696" style="visibility: inherit;" fill="rgb(0, 0, 0)" stroke="rgb(204, 204, 204)" stroke-width="1px"></line><line x1="50" y1="0" x2="45" y2="0" style="visibility: inherit;" fill="rgb(0, 0, 0)" stroke="rgb(204, 204, 204)" stroke-width="1px"></line></g><g transform="translate(40, 0)"><text x="0" y="177" dx="0em" dy="0.3em" style="text-anchor: end; visibility: hidden; font-family: Roboto, sans-serif; font-size: 12px; font-weight: 200;" fill="rgb(33, 33, 33)" stroke="none" stroke-width="1px">0.55</text><text x="0" y="157.33333333333337" dx="0em" dy="0.3em" style="text-anchor: end; visibility: inherit; font-family: Roboto, sans-serif; font-size: 12px; font-weight: 200;" fill="rgb(33, 33, 33)" stroke="none" stroke-width="1px">0.6</text><text x="0" y="137.66666666666666" dx="0em" dy="0.3em" style="text-anchor: end; visibility: hidden; font-family: Roboto, sans-serif; font-size: 12px; font-weight: 200;" fill="rgb(33, 33, 33)" stroke="none" stroke-width="1px">0.65</text><text x="0" y="118.00000000000003" dx="0em" dy="0.3em" style="text-anchor: end; visibility: inherit; font-family: Roboto, sans-serif; font-size: 12px; font-weight: 200;" fill="rgb(33, 33, 33)" stroke="none" stroke-width="1px">0.7</text><text x="0" y="98.33333333333334" dx="0em" dy="0.3em" style="text-anchor: end; visibility: hidden; font-family: Roboto, sans-serif; font-size: 12px; font-weight: 200;" fill="rgb(33, 33, 33)" stroke="none" stroke-width="1px">0.75</text><text x="0" y="78.66666666666666" dx="0em" dy="0.3em" style="text-anchor: end; visibility: inherit; font-family: Roboto, sans-serif; font-size: 12px; font-weight: 200;" fill="rgb(33, 33, 33)" stroke="none" stroke-width="1px">0.8</text><text x="0" y="59.00000000000001" dx="0em" dy="0.3em" style="text-anchor: end; visibility: hidden; font-family: Roboto, sans-serif; font-size: 12px; font-weight: 200;" fill="rgb(33, 33, 33)" stroke="none" stroke-width="1px">0.85</text><text x="0" y="39.33333333333333" dx="0em" dy="0.3em" style="text-anchor: end; visibility: inherit; font-family: Roboto, sans-serif; font-size: 12px; font-weight: 200;" fill="rgb(33, 33, 33)" stroke="none" stroke-width="1px">0.9</text><text x="0" y="19.666666666666696" dx="0em" dy="0.3em" style="text-anchor: end; visibility: hidden; font-family: Roboto, sans-serif; font-size: 12px; font-weight: 200;" fill="rgb(33, 33, 33)" stroke="none" stroke-width="1px">0.95</text><text x="0" y="0" dx="0em" dy="0.3em" style="text-anchor: end; visibility: hidden; font-family: Roboto, sans-serif; font-size: 12px; font-weight: 200;" fill="rgb(33, 33, 33)" stroke="none" stroke-width="1px">1</text></g><line x1="50" y1="0" x2="50" y2="177" fill="rgb(0, 0, 0)" stroke="rgb(204, 204, 204)" stroke-width="1px"></line></g></g><g transform="translate(50, 0)" clip-path="url(#clip_0)"><clipPath id="clip_0"><rect width="280" height="177"></rect></clipPath><g><g><g><line x1="0" y1="0" x2="0" y2="177" fill="rgb(0, 0, 0)" stroke="rgb(66, 66, 66)" stroke-width="1px" opacity="0.25"></line><line x1="25.454545454545457" y1="0" x2="25.454545454545457" y2="177" fill="rgb(0, 0, 0)" stroke="rgb(66, 66, 66)" stroke-width="1px" opacity="0.25"></line><line x1="50.909090909090914" y1="0" x2="50.909090909090914" y2="177" fill="rgb(0, 0, 0)" stroke="rgb(66, 66, 66)" stroke-width="1px" opacity="0.25"></line><line x1="76.36363636363636" y1="0" x2="76.36363636363636" y2="177" fill="rgb(0, 0, 0)" stroke="rgb(66, 66, 66)" stroke-width="1px" opacity="0.25"></line><line x1="101.81818181818183" y1="0" x2="101.81818181818183" y2="177" fill="rgb(0, 0, 0)" stroke="rgb(66, 66, 66)" stroke-width="1px" opacity="0.25"></line><line x1="127.27272727272727" y1="0" x2="127.27272727272727" y2="177" fill="rgb(0, 0, 0)" stroke="rgb(66, 66, 66)" stroke-width="1px" opacity="0.25"></line><line x1="152.72727272727272" y1="0" x2="152.72727272727272" y2="177" fill="rgb(0, 0, 0)" stroke="rgb(66, 66, 66)" stroke-width="1px" opacity="0.25"></line><line x1="178.1818181818182" y1="0" x2="178.1818181818182" y2="177" fill="rgb(0, 0, 0)" stroke="rgb(66, 66, 66)" stroke-width="1px" opacity="0.25"></line><line x1="203.63636363636365" y1="0" x2="203.63636363636365" y2="177" fill="rgb(0, 0, 0)" stroke="rgb(66, 66, 66)" stroke-width="1px" opacity="0.25"></line><line x1="229.0909090909091" y1="0" x2="229.0909090909091" y2="177" fill="rgb(0, 0, 0)" stroke="rgb(66, 66, 66)" stroke-width="1px" opacity="0.25"></line><line x1="254.54545454545453" y1="0" x2="254.54545454545453" y2="177" fill="rgb(0, 0, 0)" stroke="rgb(66, 66, 66)" stroke-width="1px" opacity="0.25"></line><line x1="280" y1="0" x2="280" y2="177" fill="rgb(0, 0, 0)" stroke="rgb(66, 66, 66)" stroke-width="1px" opacity="0.25"></line></g><g><line x1="0" y1="177" x2="280" y2="177" fill="rgb(0, 0, 0)" stroke="rgb(66, 66, 66)" stroke-width="1px" opacity="0.25"></line><line x1="0" y1="157.33333333333337" x2="280" y2="157.33333333333337" fill="rgb(0, 0, 0)" stroke="rgb(66, 66, 66)" stroke-width="1px" opacity="0.25"></line><line x1="0" y1="137.66666666666666" x2="280" y2="137.66666666666666" fill="rgb(0, 0, 0)" stroke="rgb(66, 66, 66)" stroke-width="1px" opacity="0.25"></line><line x1="0" y1="118.00000000000003" x2="280" y2="118.00000000000003" fill="rgb(0, 0, 0)" stroke="rgb(66, 66, 66)" stroke-width="1px" opacity="0.25"></line><line x1="0" y1="98.33333333333334" x2="280" y2="98.33333333333334" fill="rgb(0, 0, 0)" stroke="rgb(66, 66, 66)" stroke-width="1px" opacity="0.25"></line><line x1="0" y1="78.66666666666666" x2="280" y2="78.66666666666666" fill="rgb(0, 0, 0)" stroke="rgb(66, 66, 66)" stroke-width="1px" opacity="0.25"></line><line x1="0" y1="59.00000000000001" x2="280" y2="59.00000000000001" fill="rgb(0, 0, 0)" stroke="rgb(66, 66, 66)" stroke-width="1px" opacity="0.25"></line><line x1="0" y1="39.33333333333333" x2="280" y2="39.33333333333333" fill="rgb(0, 0, 0)" stroke="rgb(66, 66, 66)" stroke-width="1px" opacity="0.25"></line><line x1="0" y1="19.666666666666696" x2="280" y2="19.666666666666696" fill="rgb(0, 0, 0)" stroke="rgb(66, 66, 66)" stroke-width="1px" opacity="0.25"></line><line x1="0" y1="0" x2="280" y2="0" fill="rgb(0, 0, 0)" stroke="rgb(66, 66, 66)" stroke-width="1px" opacity="0.25"></line></g></g></g><g><g><line x1="0" y1="393.33333333333337" x2="280" y2="393.33333333333337" fill="rgb(0, 0, 0)" stroke="rgb(153, 153, 153)" stroke-width="1.5px"></line></g></g><g><g><line x1="0" y1="0" x2="0" y2="177" fill="rgb(0, 0, 0)" stroke="rgb(153, 153, 153)" stroke-width="1.5px"></line></g></g><g><g><g><g><g><path stroke="rgb(255, 112, 67)" stroke-width="2px" d="M12.727272727272728,56.59932136535641L25.454545454545457,51.78380772471424L38.18181818181818,44.55226545431173L50.909090909090914,51.79855750033667L63.63636363636363,65.64270067981569L76.36363636363636,50.02113309479125L89.0909090909091,53.06389613432531L101.81818181818183,44.38122475332615L114.54545454545455,58.84278078129945L127.27272727272727,72.12328578197112L140,67.05728608775593L152.72727272727272,80.68869063084125L165.45454545454547,77.02421455296431L178.1818181818182,60.18673422200686L190.9090909090909,84.02016892679018L203.63636363636365,78.49623985115059L216.36363636363635,89.78827075536465L229.0909090909091,99.86842531834048L241.8181818181818,96.89860799329927L254.54545454545453,113.27626108648398" style="fill: none;" fill="none"></path></g><g><path stroke="rgb(0, 119, 187)" stroke-width="2px" d="M12.727272727272728,-84.2864243189494L25.454545454545457,3.1846150259176387L38.18181818181818,21.660270999078055L50.909090909090914,47.18274965882306L63.63636363636363,49.074913037201064L76.36363636363636,79.77445178126034L89.0909090909091,87.05847678645661L101.81818181818183,107.7411801893694L114.54545454545455,122.79780252643943L127.27272727272727,131.03929199744243L140,149.0633715715408L152.72727272727272,154.864980835462L165.45454545454547,158.8033750555475L178.1818181818182,145.5463835154517L190.9090909090909,147.1302452096116L203.63636363636365,157.90591271969248L216.36363636363635,144.81828304233568L229.0909090909091,138.04442266273836L241.8181818181818,144.53193392641165L254.54545454545453,151.61453722569564" style="fill: none;" fill="none"></path></g></g></g></g><g opacity="0.2"><g><g><g><path stroke="rgb(255, 112, 67)" stroke-width="2px" d="M12.727272727272728,56.59932136535645L25.454545454545457,48.89449954032898L38.18181818181818,37.60998487472534L50.909090909090914,60.32019694646199L63.63636363636363,83.71761401494346L76.36363636363636,28.410881360371917L89.0909090909091,57.41509596506755L101.81818181818183,31.721806526184082L114.54545454545455,80.1707669099172L127.27272727272727,91.84328794479372L140,59.504234790802L152.72727272727272,101.06161594390869L165.45454545454547,71.5394655863444L178.1818181818182,34.96350010236105L190.9090909090909,119.7423056761424L203.63636363636365,70.21424214045209L216.36363636363635,106.72153870264691L229.0909090909091,114.98609781265259L241.8181818181818,92.44433442751568L254.54545454545453,137.84124374389648" style="fill: none;" fill="none"></path></g><g><path stroke="rgb(0, 119, 187)" stroke-width="2px" d="M12.727272727272728,-84.2864243189494L25.454545454545457,55.66723863283794L38.18181818181818,39.39690073331197L50.909090909090914,77.1971845626831L63.63636363636363,51.54532154401143L76.36363636363636,122.2429656982422L89.0909090909091,97.47474908828735L101.81818181818183,137.8967603047689L114.54545454545455,145.003395875295L127.27272727272727,143.27694336573285L140,175.93601385752362L152.72727272727272,163.53582262992862L165.45454545454547,164.69810684521994L178.1818181818182,125.68686803181969L190.9090909090909,149.50417598088583L203.63636363636365,174.06181414922082L216.36363636363635,125.19237677256267L229.0909090909091,127.88535197575888L241.8181818181818,154.26221251487735L254.54545454545453,162.2377947966258" style="fill: none;" fill="none"></path></g></g></g></g></g></g><g transform="translate(50, 177)" clip-path="url(#clip_1)"><clipPath id="clip_1"><rect width="280" height="23"></rect></clipPath><g><g><line x1="0" y1="0" x2="0" y2="5" style="visibility: inherit;" fill="rgb(0, 0, 0)" stroke="rgb(204, 204, 204)" stroke-width="1px"></line><line x1="25.454545454545457" y1="0" x2="25.454545454545457" y2="5" style="visibility: inherit;" fill="rgb(0, 0, 0)" stroke="rgb(204, 204, 204)" stroke-width="1px"></line><line x1="50.909090909090914" y1="0" x2="50.909090909090914" y2="5" style="visibility: inherit;" fill="rgb(0, 0, 0)" stroke="rgb(204, 204, 204)" stroke-width="1px"></line><line x1="76.36363636363636" y1="0" x2="76.36363636363636" y2="5" style="visibility: inherit;" fill="rgb(0, 0, 0)" stroke="rgb(204, 204, 204)" stroke-width="1px"></line><line x1="101.81818181818183" y1="0" x2="101.81818181818183" y2="5" style="visibility: inherit;" fill="rgb(0, 0, 0)" stroke="rgb(204, 204, 204)" stroke-width="1px"></line><line x1="127.27272727272727" y1="0" x2="127.27272727272727" y2="5" style="visibility: inherit;" fill="rgb(0, 0, 0)" stroke="rgb(204, 204, 204)" stroke-width="1px"></line><line x1="152.72727272727272" y1="0" x2="152.72727272727272" y2="5" style="visibility: inherit;" fill="rgb(0, 0, 0)" stroke="rgb(204, 204, 204)" stroke-width="1px"></line><line x1="178.1818181818182" y1="0" x2="178.1818181818182" y2="5" style="visibility: inherit;" fill="rgb(0, 0, 0)" stroke="rgb(204, 204, 204)" stroke-width="1px"></line><line x1="203.63636363636365" y1="0" x2="203.63636363636365" y2="5" style="visibility: inherit;" fill="rgb(0, 0, 0)" stroke="rgb(204, 204, 204)" stroke-width="1px"></line><line x1="229.0909090909091" y1="0" x2="229.0909090909091" y2="5" style="visibility: inherit;" fill="rgb(0, 0, 0)" stroke="rgb(204, 204, 204)" stroke-width="1px"></line><line x1="254.54545454545453" y1="0" x2="254.54545454545453" y2="5" style="visibility: inherit;" fill="rgb(0, 0, 0)" stroke="rgb(204, 204, 204)" stroke-width="1px"></line><line x1="280" y1="0" x2="280" y2="5" style="visibility: inherit;" fill="rgb(0, 0, 0)" stroke="rgb(204, 204, 204)" stroke-width="1px"></line></g><g transform="translate(0, 8)"><text x="0" y="0" dx="0em" dy="0.95em" style="text-anchor: middle; visibility: hidden; font-family: Roboto, sans-serif; font-size: 12px; font-weight: 200;" fill="rgb(33, 33, 33)" stroke="none" stroke-width="1px">0</text><text x="25.454545454545457" y="0" dx="0em" dy="0.95em" style="text-anchor: middle; visibility: inherit; font-family: Roboto, sans-serif; font-size: 12px; font-weight: 200;" fill="rgb(33, 33, 33)" stroke="none" stroke-width="1px">200</text><text x="50.909090909090914" y="0" dx="0em" dy="0.95em" style="text-anchor: middle; visibility: hidden; font-family: Roboto, sans-serif; font-size: 12px; font-weight: 200;" fill="rgb(33, 33, 33)" stroke="none" stroke-width="1px">400</text><text x="76.36363636363636" y="0" dx="0em" dy="0.95em" style="text-anchor: middle; visibility: inherit; font-family: Roboto, sans-serif; font-size: 12px; font-weight: 200;" fill="rgb(33, 33, 33)" stroke="none" stroke-width="1px">600</text><text x="101.81818181818183" y="0" dx="0em" dy="0.95em" style="text-anchor: middle; visibility: hidden; font-family: Roboto, sans-serif; font-size: 12px; font-weight: 200;" fill="rgb(33, 33, 33)" stroke="none" stroke-width="1px">800</text><text x="127.27272727272727" y="0" dx="0em" dy="0.95em" style="text-anchor: middle; visibility: inherit; font-family: Roboto, sans-serif; font-size: 12px; font-weight: 200;" fill="rgb(33, 33, 33)" stroke="none" stroke-width="1px">1k</text><text x="152.72727272727272" y="0" dx="0em" dy="0.95em" style="text-anchor: middle; visibility: hidden; font-family: Roboto, sans-serif; font-size: 12px; font-weight: 200;" fill="rgb(33, 33, 33)" stroke="none" stroke-width="1px">1.2k</text><text x="178.1818181818182" y="0" dx="0em" dy="0.95em" style="text-anchor: middle; visibility: inherit; font-family: Roboto, sans-serif; font-size: 12px; font-weight: 200;" fill="rgb(33, 33, 33)" stroke="none" stroke-width="1px">1.4k</text><text x="203.63636363636365" y="0" dx="0em" dy="0.95em" style="text-anchor: middle; visibility: hidden; font-family: Roboto, sans-serif; font-size: 12px; font-weight: 200;" fill="rgb(33, 33, 33)" stroke="none" stroke-width="1px">1.6k</text><text x="229.0909090909091" y="0" dx="0em" dy="0.95em" style="text-anchor: middle; visibility: inherit; font-family: Roboto, sans-serif; font-size: 12px; font-weight: 200;" fill="rgb(33, 33, 33)" stroke="none" stroke-width="1px">1.8k</text><text x="254.54545454545453" y="0" dx="0em" dy="0.95em" style="text-anchor: middle; visibility: hidden; font-family: Roboto, sans-serif; font-size: 12px; font-weight: 200;" fill="rgb(33, 33, 33)" stroke="none" stroke-width="1px">2k</text><text x="280" y="0" dx="0em" dy="0.95em" style="text-anchor: middle; visibility: hidden; font-family: Roboto, sans-serif; font-size: 12px; font-weight: 200;" fill="rgb(33, 33, 33)" stroke="none" stroke-width="1px">2.2k</text></g><line x1="0" y1="0" x2="280" y2="0" fill="rgb(0, 0, 0)" stroke="rgb(204, 204, 204)" stroke-width="1px"></line></g></g></g></g></svg>


## Future work & Improvements
